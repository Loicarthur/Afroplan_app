/**
 * Language Context - AfroPlan
 * Syst√®me de traduction multi-langues
 * Langues support√©es: FR, EN, DE, ES
 *
 * - D√©tecte automatiquement la langue du t√©l√©phone au premier lancement
 * - Persiste le choix via AsyncStorage
 * - Fournit la fonction t() pour traduire toutes les cha√Ænes de l'app
 */

import React, { createContext, useContext, useState, useEffect, useCallback } from 'react';
import AsyncStorage from '@react-native-async-storage/async-storage';
import { Platform, NativeModules } from 'react-native';

// Types
export type Language = 'fr' | 'en' | 'de' | 'es';

interface LanguageContextType {
  language: Language;
  setLanguage: (lang: Language) => Promise<void>;
  t: (key: string, params?: Record<string, string | number>) => string;
  languages: { code: Language; name: string; flag: string }[];
  isReady: boolean;
}

// Available languages
const LANGUAGES = [
  { code: 'fr' as Language, name: 'Fran√ßais', flag: 'üá´üá∑' },
  { code: 'en' as Language, name: 'English', flag: 'üá¨üáß' },
  { code: 'de' as Language, name: 'Deutsch', flag: 'üá©üá™' },
  { code: 'es' as Language, name: 'Espa√±ol', flag: 'üá™üá∏' },
];

// ---------------------------------------------------------------------------
// D√©tection de la langue du t√©l√©phone
// ---------------------------------------------------------------------------
function getDeviceLocale(): Language {
  try {
    let locale = 'fr';

    if (Platform.OS === 'ios') {
      locale =
        NativeModules.SettingsManager?.settings?.AppleLocale ||
        NativeModules.SettingsManager?.settings?.AppleLanguages?.[0] ||
        'fr';
    } else if (Platform.OS === 'android') {
      locale = NativeModules.I18nManager?.localeIdentifier || 'fr';
    }

    const lang = locale.substring(0, 2).toLowerCase();
    if (['fr', 'en', 'de', 'es'].includes(lang)) {
      return lang as Language;
    }
  } catch {
    // Silencieux
  }
  return 'fr';
}

// ---------------------------------------------------------------------------
// Traductions
// ---------------------------------------------------------------------------
const translations: Record<Language, Record<string, string>> = {
  fr: {
    // Common
    'common.loading': 'Chargement...',
    'common.error': 'Erreur',
    'common.success': 'Succ√®s',
    'common.cancel': 'Annuler',
    'common.confirm': 'Confirmer',
    'common.save': 'Enregistrer',
    'common.delete': 'Supprimer',
    'common.edit': 'Modifier',
    'common.close': 'Fermer',
    'common.next': 'Suivant',
    'common.back': 'Retour',
    'common.search': 'Rechercher',
    'common.seeAll': 'Voir tout',
    'common.seeLess': 'Voir moins',
    'common.seeResults': 'Voir les r√©sultats',
    'common.add': 'Ajouter',
    'common.errorOccurred': 'Une erreur est survenue. Veuillez r√©essayer.',
    'common.available': 'Dispo',
    'common.open': 'Ouvert',
    'common.closed': 'Ferm√©',
    'common.verified': 'V√©rifi√©',
    'common.results': 'r√©sultat(s)',
    'common.found': 'trouv√©(s)',
    'common.both': 'Les deux',
    'common.reset': 'R√©initialiser',
    'common.support': 'Support',
    'common.terms': 'CGU',
    'common.privacy': 'Confidentialit√©',
    'common.joinUs': 'Rejoignez-nous',
    'common.copyright': '¬© 2025 AfroPlan. Tous droits r√©serv√©s.',
    'common.today': "Aujourd'hui",
    'common.pending': 'En attente',
    'common.confirmed': 'Confirm√©',
    'common.start': 'Commencer',
    'common.newMessages': '{count} nouveaux',
    'common.warning': 'Attention',

    // Auth
    'auth.login': 'Connexion',
    'auth.register': 'Inscription',
    'auth.logout': 'D√©connexion',
    'auth.email': 'Email',
    'auth.password': 'Mot de passe',
    'auth.forgotPassword': 'Mot de passe oubli√© ?',
    'auth.noAccount': 'Pas de compte ?',
    'auth.hasAccount': 'D√©j√† un compte ?',
    'auth.loginRequired': 'Connexion requise',
    'auth.loginRequiredMessage': 'Vous devez √™tre connect√© pour effectuer un paiement.',
    'auth.loginRequiredBooking': 'Vous devez √™tre connect√© pour r√©server.',
    'auth.loginRequiredFavorite': 'Vous devez √™tre connect√© pour ajouter aux favoris.',
    'auth.loginToSee': 'Connectez-vous pour voir les d√©tails du salon et r√©server',
    'auth.createAccount': 'Cr√©er un compte',
    'auth.logoutConfirm': '√ätes-vous s√ªr de vouloir vous d√©connecter ?',
    'auth.logoutAction': 'D√©connecter',

    // Home
    'home.welcome': 'Bienvenue sur AfroPlan',
    'home.hello': 'Bonjour {name}',
    'home.readyForHairstyle': 'Pr√™t(e) pour une nouvelle coiffure ?',
    'home.searchSalon': 'Rechercher mon salon / coiffeur',
    'home.searchSubtitle': 'Trouve le style qui te correspond',
    'home.promotions': 'Offres du moment',
    'home.hairstyles': 'Styles de coiffure',
    'home.nearbyCoiffeurs': 'Coiffeurs √† proximit√©',
    'home.popularSalons': 'Salons populaires',
    'home.tipsAndInspiration': 'Conseils & Inspiration',
    'home.areYouCoiffeur': 'Tu es coiffeur(se) ?',
    'home.joinAfroPlanPro': 'Rejoins AfroPlan Pro et d√©veloppe ton activit√©',
    'home.discoverPro': 'D√©couvrir AfroPlan Pro',

    // Search Flow
    'search.findCoiffeur': 'Trouve facilement ton coiffeur afro',
    'search.quickQuestions': 'Quelques questions rapides pour te proposer les meilleurs salons adapt√©s √† tes besoins.',
    'search.chooseStyle': 'Choisis ta coiffure',
    'search.whatStyle': 'Quel style te ferait plaisir ?',
    'search.quickFilter': 'Filtre rapide',
    'search.optional': 'Optionnel - Affine ta recherche',
    'search.hairType': 'Type de cheveux',
    'search.whereCoiffeur': 'O√π souhaites-tu te faire coiffer ?',
    'search.inSalon': 'En salon',
    'search.atHome': '√Ä domicile',
    'search.goToSalon': 'Se d√©placer au salon',
    'search.coiffeurComesHome': 'Le coiffeur vient chez vous',
    'search.budgetDistance': 'Budget & Distance',
    'search.maxBudget': 'Budget maximum',
    'search.maxDistance': 'Distance maximum',
    'search.showAllSalons': 'Je veux voir tous les salons (ignorer les filtres)',
    'search.paymentInfo': 'Tu pourras choisir de payer le montant total ou un acompte lors de la r√©servation.',
    'search.canGoBack': 'Tu peux revenir en arri√®re √† tout moment',
    'search.quickPay': 'Paiement rapide',
    'search.placeholder': 'Salon, coiffeur, style...',
    'search.title': 'Recherche',
    'search.advancedFilters': 'Filtres avanc√©s',
    'search.maxDistanceLabel': 'Distance maximum',
    'search.minRating': 'Note minimum',
    'search.location': 'Lieu',
    'search.onlyPromotions': 'Uniquement les promotions',
    'search.seeResultsCount': 'Voir {count} r√©sultats',
    'search.searchStyle': 'Rechercher un style...',
    'search.styleGallery': 'Galerie de Styles',

    // Booking
    'booking.book': 'R√©server',
    'booking.confirmed': 'Confirm√©',
    'booking.pending': 'En attente',
    'booking.cancelled': 'Annul√©',
    'booking.completed': 'Termin√©',
    'booking.yourBookings': 'Mes r√©servations',
    'booking.upcoming': '√Ä venir',
    'booking.past': 'Pass√©es',
    'booking.selectService': 'Veuillez s√©lectionner un service',
    'booking.reservation': 'R√©servation',

    // Chat
    'chat.writeMessage': '√âcrivez votre message...',
    'chat.online': 'En ligne',
    'chat.reservationConfirmed': 'R√©servation confirm√©e ! Vous pouvez maintenant discuter.',
    'chat.willBeLate': "J'aurai un peu de retard",
    'chat.onMyWay': 'Je suis en route',
    'chat.whatTime': '√Ä quelle heure exactement ?',
    'chat.sendAddress': "Pouvez-vous m'envoyer l'adresse ?",

    // Coiffeur Dashboard
    'coiffeur.developActivity': 'D√©veloppez votre activit√©',
    'coiffeur.joinCommunity': 'Rejoignez la communaut√© AfroPlan Pro et boostez votre salon',
    'coiffeur.rdvManagement': 'Gestion des RDV',
    'coiffeur.manageReservations': 'G√©rez facilement vos r√©servations',
    'coiffeur.moreClients': 'Plus de clients',
    'coiffeur.increaseVisibility': 'Augmentez votre visibilit√©',
    'coiffeur.statistics': 'Statistiques',
    'coiffeur.trackPerformance': 'Suivez vos performances',
    'coiffeur.payments': 'Paiements',
    'coiffeur.securePayment': 'Encaissez en toute s√©curit√©',
    'coiffeur.readyToStart': 'Pr√™t √† commencer ?',
    'coiffeur.registerFree': 'Inscrivez-vous gratuitement et commencez √† recevoir des r√©servations',
    'coiffeur.createProAccount': 'Cr√©er mon compte Pro',
    'coiffeur.needPhotoHelp': 'Besoin d\'aide pour vos photos ?',
    'coiffeur.photoHelpDesc': 'Si vous avez des difficult√©s pour des prises de photos professionnelles, contactez-nous et nous viendrons vous aider gratuitement !',
    'coiffeur.space': 'Espace Coiffeur',
    'coiffeur.launchActivity': 'Lancez votre activit√©',
    'coiffeur.createSalonDesc': 'Cr√©ez votre salon en quelques clics et recevez des r√©servations',
    'coiffeur.createMySalon': 'Cr√©er mon salon',
    'coiffeur.createSalonCTA': 'Configurez votre salon et commencez √† recevoir des r√©servations d√®s maintenant',
    'coiffeur.greeting.morning': 'Bonjour',
    'coiffeur.greeting.afternoon': 'Bon apr√®s-midi',
    'coiffeur.greeting.evening': 'Bonsoir',
    'coiffeur.updateError': 'Impossible de mettre √† jour votre profil. R√©essayez.',
    'coiffeur.monthlyRevenue': 'Revenus (mois)',
    'coiffeur.quickActions': 'Actions rapides',
    'coiffeur.manageMySalon': 'G√©rer mon salon',
    'coiffeur.manageMyServices': 'G√©rer mes services',
    'coiffeur.seeReservations': 'Voir les r√©servations',
    'coiffeur.clientMessages': 'Messages clients',
    'coiffeur.upcomingAppointments': 'Prochains rendez-vous',

    // Profile
    'profile.myProfile': 'Mon profil',
    'profile.settings': 'Param√®tres',
    'profile.language': 'Langue',
    'profile.notifications': 'Notifications',
    'profile.help': 'Aide',
    'profile.about': '√Ä propos',
    'profile.loginMessage': 'Connectez-vous pour g√©rer votre profil, vos rendez-vous et vos messages',
    'profile.coiffeurMode': 'Mode Coiffeur',
    'profile.switchToCoiffeur': 'Basculer vers l\'espace coiffeur',
    'profile.myAppointments': 'Mes rendez-vous',
    'profile.messages': 'Messages',
    'profile.account': 'Compte',
    'profile.logoutButton': 'Se d√©connecter',

    // Favorites
    'favorites.title': 'Favoris',
    'favorites.yourFavorites': 'Vos favoris',
    'favorites.loginMessage': 'Connectez-vous pour sauvegarder vos salons et styles pr√©f√©r√©s',
    'favorites.subtitle': 'Vos salons et styles pr√©f√©r√©s',
    'favorites.salons': 'Salons',

    // Hairstyles
    'hairstyle.tresses': 'Tresses',
    'hairstyle.locks': 'Locks',
    'hairstyle.coupe': 'Coupe',
    'hairstyle.soins': 'Soins',
    'hairstyle.coloration': 'Coloration',
    'hairstyle.tissage': 'Tissage',
    'hairstyle.cornrows': 'Cornrows',
    'hairstyle.afro': 'Afro',

    // Role selection
    'role.chooseSpace': 'Choisissez votre espace',
    'role.clientSpace': 'Espace Client',
    'role.clientSubtitle': 'Trouve ton coiffeur afro et r√©serve en quelques clics',
    'role.coiffeurSpace': 'Espace Coiffeur',
    'role.coiffeurSubtitle': 'G√®re tes rendez-vous et d√©veloppe ton activit√©',
    'role.start': 'Commencer',
    'role.access': 'Acc√©der',
    'role.tagline': 'La coiffure afro, r√©invent√©e.',
    'role.trust': 'D√©j√† +100 coiffeurs nous font confiance.',
    'role.switchRole': 'Changer de parcours',
    'role.switchToClient': 'Passer en mode Client',
    'role.switchToCoiffeur': 'Passer en mode Coiffeur',

    // Onboarding
    'onboarding.slide1Title': 'Des coiffeurs passionn√©s',
    'onboarding.slide1Subtitle': 'Sp√©cialistes des cheveux afro pr√®s de chez toi',
    'onboarding.slide2Title': 'Trouve ton style parfait',
    'onboarding.slide2Subtitle': 'Des centaines de coiffures afro √† port√©e de main',
    'onboarding.slide3Title': 'R√©serve en quelques clics',
    'onboarding.slide3Subtitle': 'Simple, rapide et sans stress',
    'onboarding.touchToContinue': 'Touchez l\'√©cran pour continuer',

    // Geolocation
    'geo.enableLocation': 'Activer la g√©olocalisation',
    'geo.locationDesc': 'Pour trouver les salons pr√®s de chez toi',
    'geo.permissionDenied': 'Permission de localisation refus√©e',
    'geo.maxDistance': 'Distance maximum',
    'geo.nearbyRadius': 'Rayon de recherche',

    // Checkout & Payment
    'checkout.title': 'Paiement',
    'checkout.secure': 'S√©curis√©',
    'checkout.yourBooking': 'Votre r√©servation',
    'checkout.paymentMethod': 'Moyen de paiement',
    'checkout.creditCard': 'Carte bancaire',
    'checkout.priceDetail': 'D√©tail du prix',
    'checkout.servicePrice': 'Prix du service',
    'checkout.depositNow': 'Acompte √† payer maintenant',
    'checkout.depositInfo': 'Cet acompte confirme votre r√©servation et sera d√©duit du prix total. Le reste sera pay√© directement au salon le jour du rendez-vous.',
    'checkout.remainingAtSalon': 'Reste √† payer au salon',
    'checkout.securePayment': 'Paiement s√©curis√© en 2 √©tapes',
    'checkout.step1': 'Payez l\'acompte maintenant',
    'checkout.step2': 'R√©glez le reste au salon',
    'checkout.payDeposit': 'Payer l\'acompte de',
    'checkout.payFull': 'Payer la totalit√©',
    'checkout.paymentSuccess': 'Paiement r√©ussi !',
    'checkout.paymentSuccessDesc': 'Votre r√©servation est confirm√©e.',
    'checkout.paymentError': 'Erreur de paiement',
    'checkout.paymentErrorDesc': 'Une erreur est survenue. Veuillez r√©essayer.',
    'checkout.viewBooking': 'Voir ma r√©servation',
    'checkout.termsNotice': 'Paiement s√©curis√© par Stripe. En payant, vous acceptez nos conditions d\'utilisation.',
    'checkout.choosePaymentType': 'Choisir le type de paiement',
    'checkout.depositOnly': 'Acompte uniquement',
    'checkout.fullPayment': 'Paiement int√©gral',
    'checkout.commission': 'Commission AfroPlan',

    // Salon Registration & Detail
    'salon.photos': 'Photos du salon',
    'salon.addPhotos': 'Ajoutez jusqu\'√† {max} photos de votre salon',
    'salon.info': 'Informations du salon',
    'salon.name': 'Nom du salon',
    'salon.description': 'Description',
    'salon.phone': 'T√©l√©phone',
    'salon.email': 'Email',
    'salon.emailHint': 'L\'email est celui de votre compte et ne peut pas √™tre modifi√©',
    'salon.location': 'Localisation',
    'salon.address': 'Adresse',
    'salon.city': 'Ville',
    'salon.postalCode': 'Code postal',
    'salon.specialties': 'Sp√©cialit√©s de coiffure afro',
    'salon.selectedSpecialties': 's√©lectionn√©es',
    'salon.selectSpecialties': 'S√©lectionnez vos sp√©cialit√©s ({count} s√©lectionn√©es)',
    'salon.save': 'Enregistrer les modifications',
    'salon.saving': 'Enregistrement...',
    'salon.saved': 'Salon enregistr√© !',
    'salon.savedDesc': 'Les informations de votre salon ont √©t√© sauvegard√©es.',
    'salon.openingHours': 'Horaires d\'ouverture',
    'salon.homeService': 'Service √† domicile',
    'salon.homeServiceDesc': 'Proposez-vous un service √† domicile ?',
    'salon.homeServiceFee': 'Frais de d√©placement',
    'salon.homeServiceTravel': 'Je me d√©place chez les clients',
    'salon.connectLogin': 'Se connecter',
    'salon.createPro': 'Cr√©er un compte Pro',
    'salon.mySalon': 'Mon salon',
    'salon.loginMessage': 'Connectez-vous pour cr√©er et g√©rer votre salon, ajouter vos photos et sp√©cialit√©s',
    'salon.limitReached': 'Limite atteinte',
    'salon.maxPhotosMessage': 'Vous ne pouvez ajouter que {max} photos maximum.',
    'salon.permissionRequired': 'Permission requise',
    'salon.galleryPermission': 'Vous devez autoriser l\'acc√®s √† la galerie pour ajouter des photos.',
    'salon.cameraPermission': 'Vous devez autoriser l\'acc√®s √† la cam√©ra pour prendre des photos.',
    'salon.deletePhoto': 'Supprimer la photo',
    'salon.deletePhotoConfirm': 'Voulez-vous vraiment supprimer cette photo ?',
    'salon.notFound': 'Salon introuvable',
    'salon.notFoundDesc': 'Ce salon n\'existe pas ou a √©t√© supprim√©.',
    'salon.about': '√Ä propos',
    'salon.services': 'Services',
    'salon.gallery': 'Galerie',
    'salon.noServices': 'Aucun service disponible',
    'salon.selectServiceHint': 'S√©lectionnez un service',
    'salon.call': 'Appeler',
    'salon.directions': 'Itin√©raire',
    'salon.photoChoice': 'Ajouter une photo',
    'salon.takePhoto': 'Prendre une photo',
    'salon.chooseFromGallery': 'Choisir depuis la galerie',
    'salon.namePlaceholder': 'Ex: Afro Beauty Paris',
    'salon.descriptionPlaceholder': 'D√©crivez votre salon, vos sp√©cialit√©s...',
    'salon.phonePlaceholder': 'Ex: +33 6 12 34 56 78',
    'salon.addressPlaceholder': 'Ex: 123 Rue de la Paix',
    'salon.cityPlaceholder': 'Ex: Paris',

    // Tabs
    'tab.home': 'Accueil',
    'tab.styles': 'Styles',
    'tab.search': 'Recherche',
    'tab.favorites': 'Favoris',
    'tab.profile': 'Profil',

    // Days
    'day.monday': 'Lundi',
    'day.tuesday': 'Mardi',
    'day.wednesday': 'Mercredi',
    'day.thursday': 'Jeudi',
    'day.friday': 'Vendredi',
    'day.saturday': 'Samedi',
    'day.sunday': 'Dimanche',
  },

  en: {
    'common.loading': 'Loading...',
    'common.error': 'Error',
    'common.success': 'Success',
    'common.cancel': 'Cancel',
    'common.confirm': 'Confirm',
    'common.save': 'Save',
    'common.delete': 'Delete',
    'common.edit': 'Edit',
    'common.close': 'Close',
    'common.next': 'Next',
    'common.back': 'Back',
    'common.search': 'Search',
    'common.seeAll': 'See all',
    'common.seeLess': 'See less',
    'common.seeResults': 'See results',
    'common.add': 'Add',
    'common.errorOccurred': 'An error occurred. Please try again.',
    'common.available': 'Available',
    'common.open': 'Open',
    'common.closed': 'Closed',
    'common.verified': 'Verified',
    'common.results': 'result(s)',
    'common.found': 'found',
    'common.both': 'Both',
    'common.reset': 'Reset',
    'common.support': 'Support',
    'common.terms': 'Terms',
    'common.privacy': 'Privacy',
    'common.joinUs': 'Join us',
    'common.copyright': '¬© 2025 AfroPlan. All rights reserved.',
    'common.today': 'Today',
    'common.pending': 'Pending',
    'common.confirmed': 'Confirmed',
    'common.start': 'Get started',
    'common.newMessages': '{count} new',
    'common.warning': 'Warning',
    'auth.login': 'Login',
    'auth.register': 'Sign up',
    'auth.logout': 'Logout',
    'auth.email': 'Email',
    'auth.password': 'Password',
    'auth.loginRequired': 'Login required',
    'auth.loginRequiredMessage': 'You must be logged in to make a payment.',
    'auth.loginRequiredBooking': 'You must be logged in to book.',
    'auth.loginRequiredFavorite': 'You must be logged in to add to favorites.',
    'auth.loginToSee': 'Log in to see salon details and book',
    'auth.createAccount': 'Create account',
    'auth.forgotPassword': 'Forgot password?',
    'auth.noAccount': 'No account?',
    'auth.hasAccount': 'Already have an account?',
    'auth.logoutConfirm': 'Are you sure you want to log out?',
    'auth.logoutAction': 'Log out',
    'home.welcome': 'Welcome to AfroPlan',
    'home.hello': 'Hello {name}',
    'home.readyForHairstyle': 'Ready for a new hairstyle?',
    'home.searchSalon': 'Search my salon / hairstylist',
    'home.searchSubtitle': 'Find the style that suits you',
    'home.promotions': 'Current offers',
    'home.hairstyles': 'Hairstyles',
    'home.nearbyCoiffeurs': 'Nearby hairstylists',
    'home.popularSalons': 'Popular salons',
    'home.tipsAndInspiration': 'Tips & Inspiration',
    'home.areYouCoiffeur': 'Are you a hairstylist?',
    'home.joinAfroPlanPro': 'Join AfroPlan Pro and grow your business',
    'home.discoverPro': 'Discover AfroPlan Pro',
    'search.findCoiffeur': 'Easily find your afro hairstylist',
    'search.quickQuestions': 'A few quick questions to suggest the best salons for your needs.',
    'search.chooseStyle': 'Choose your hairstyle',
    'search.whatStyle': 'What style would you like?',
    'search.quickFilter': 'Quick filter',
    'search.optional': 'Optional - Refine your search',
    'search.hairType': 'Hair type',
    'search.whereCoiffeur': 'Where would you like to get your hair done?',
    'search.inSalon': 'In salon',
    'search.atHome': 'At home',
    'search.goToSalon': 'Go to the salon',
    'search.coiffeurComesHome': 'The hairstylist comes to you',
    'search.budgetDistance': 'Budget & Distance',
    'search.maxBudget': 'Maximum budget',
    'search.maxDistance': 'Maximum distance',
    'search.showAllSalons': 'I want to see all salons (ignore filters)',
    'search.paymentInfo': 'You can choose to pay the full amount or a deposit when booking.',
    'search.canGoBack': 'You can go back at any time',
    'search.quickPay': 'Quick pay',
    'search.placeholder': 'Salon, hairstylist, style...',
    'search.title': 'Search',
    'search.advancedFilters': 'Advanced filters',
    'search.maxDistanceLabel': 'Maximum distance',
    'search.minRating': 'Minimum rating',
    'search.location': 'Location',
    'search.onlyPromotions': 'Promotions only',
    'search.seeResultsCount': 'See {count} results',
    'search.searchStyle': 'Search a style...',
    'search.styleGallery': 'Style Gallery',
    'booking.book': 'Book',
    'booking.confirmed': 'Confirmed',
    'booking.pending': 'Pending',
    'booking.cancelled': 'Cancelled',
    'booking.completed': 'Completed',
    'booking.yourBookings': 'My bookings',
    'booking.upcoming': 'Upcoming',
    'booking.past': 'Past',
    'booking.selectService': 'Please select a service',
    'booking.reservation': 'Reservation',
    'chat.writeMessage': 'Write your message...',
    'chat.online': 'Online',
    'chat.reservationConfirmed': 'Booking confirmed! You can now chat.',
    'chat.willBeLate': "I'll be a bit late",
    'chat.onMyWay': "I'm on my way",
    'chat.whatTime': 'What time exactly?',
    'chat.sendAddress': 'Can you send me the address?',
    'coiffeur.developActivity': 'Grow your business',
    'coiffeur.joinCommunity': 'Join the AfroPlan Pro community and boost your salon',
    'coiffeur.rdvManagement': 'Booking management',
    'coiffeur.manageReservations': 'Easily manage your bookings',
    'coiffeur.moreClients': 'More clients',
    'coiffeur.increaseVisibility': 'Increase your visibility',
    'coiffeur.statistics': 'Statistics',
    'coiffeur.trackPerformance': 'Track your performance',
    'coiffeur.payments': 'Payments',
    'coiffeur.securePayment': 'Get paid securely',
    'coiffeur.readyToStart': 'Ready to start?',
    'coiffeur.registerFree': 'Sign up for free and start receiving bookings',
    'coiffeur.createProAccount': 'Create my Pro account',
    'coiffeur.needPhotoHelp': 'Need help with your photos?',
    'coiffeur.photoHelpDesc': 'If you have trouble taking professional photos, contact us and we\'ll come help you for free!',
    'coiffeur.space': 'Hairstylist Space',
    'coiffeur.launchActivity': 'Launch your business',
    'coiffeur.createSalonDesc': 'Create your salon in a few clicks and start receiving bookings',
    'coiffeur.createMySalon': 'Create my salon',
    'coiffeur.createSalonCTA': 'Set up your salon and start receiving bookings now',
    'coiffeur.greeting.morning': 'Good morning',
    'coiffeur.greeting.afternoon': 'Good afternoon',
    'coiffeur.greeting.evening': 'Good evening',
    'coiffeur.updateError': 'Unable to update your profile. Please try again.',
    'coiffeur.monthlyRevenue': 'Revenue (month)',
    'coiffeur.quickActions': 'Quick actions',
    'coiffeur.manageMySalon': 'Manage my salon',
    'coiffeur.manageMyServices': 'Manage my services',
    'coiffeur.seeReservations': 'See reservations',
    'coiffeur.clientMessages': 'Client messages',
    'coiffeur.upcomingAppointments': 'Upcoming appointments',
    'profile.myProfile': 'My profile',
    'profile.settings': 'Settings',
    'profile.language': 'Language',
    'profile.notifications': 'Notifications',
    'profile.help': 'Help',
    'profile.about': 'About',
    'profile.loginMessage': 'Log in to manage your profile, appointments and messages',
    'profile.coiffeurMode': 'Hairstylist Mode',
    'profile.switchToCoiffeur': 'Switch to hairstylist space',
    'profile.myAppointments': 'My appointments',
    'profile.messages': 'Messages',
    'profile.account': 'Account',
    'profile.logoutButton': 'Log out',
    'favorites.title': 'Favorites',
    'favorites.yourFavorites': 'Your favorites',
    'favorites.loginMessage': 'Log in to save your favorite salons and styles',
    'favorites.subtitle': 'Your favorite salons and styles',
    'favorites.salons': 'Salons',
    'hairstyle.tresses': 'Braids',
    'hairstyle.locks': 'Locs',
    'hairstyle.coupe': 'Cut',
    'hairstyle.soins': 'Care',
    'hairstyle.coloration': 'Coloring',
    'hairstyle.tissage': 'Weave',
    'hairstyle.cornrows': 'Cornrows',
    'hairstyle.afro': 'Afro',
    'role.chooseSpace': 'Choose your space',
    'role.clientSpace': 'Client Space',
    'role.clientSubtitle': 'Find your afro hairstylist and book in a few clicks',
    'role.coiffeurSpace': 'Hairstylist Space',
    'role.coiffeurSubtitle': 'Manage your appointments and grow your business',
    'role.start': 'Get started',
    'role.access': 'Access',
    'role.tagline': 'Afro hairstyling, reinvented.',
    'role.trust': 'Already 100+ hairstylists trust us.',
    'role.switchRole': 'Switch path',
    'role.switchToClient': 'Switch to Client mode',
    'role.switchToCoiffeur': 'Switch to Hairstylist mode',
    'onboarding.slide1Title': 'Passionate hairstylists',
    'onboarding.slide1Subtitle': 'Afro hair specialists near you',
    'onboarding.slide2Title': 'Find your perfect style',
    'onboarding.slide2Subtitle': 'Hundreds of afro hairstyles at your fingertips',
    'onboarding.slide3Title': 'Book in a few clicks',
    'onboarding.slide3Subtitle': 'Simple, fast and stress-free',
    'onboarding.touchToContinue': 'Tap to continue',
    'geo.enableLocation': 'Enable location',
    'geo.locationDesc': 'To find salons near you',
    'geo.permissionDenied': 'Location permission denied',
    'geo.maxDistance': 'Maximum distance',
    'geo.nearbyRadius': 'Search radius',
    'checkout.title': 'Payment',
    'checkout.secure': 'Secure',
    'checkout.yourBooking': 'Your booking',
    'checkout.paymentMethod': 'Payment method',
    'checkout.creditCard': 'Credit card',
    'checkout.priceDetail': 'Price detail',
    'checkout.servicePrice': 'Service price',
    'checkout.depositNow': 'Deposit to pay now',
    'checkout.depositInfo': 'This deposit confirms your booking and will be deducted from the total price. The rest is paid directly at the salon on appointment day.',
    'checkout.remainingAtSalon': 'Remaining to pay at salon',
    'checkout.securePayment': 'Secure 2-step payment',
    'checkout.step1': 'Pay the deposit now',
    'checkout.step2': 'Pay the rest at the salon',
    'checkout.payDeposit': 'Pay deposit of',
    'checkout.payFull': 'Pay in full',
    'checkout.paymentSuccess': 'Payment successful!',
    'checkout.paymentSuccessDesc': 'Your booking is confirmed.',
    'checkout.paymentError': 'Payment error',
    'checkout.paymentErrorDesc': 'An error occurred. Please try again.',
    'checkout.viewBooking': 'View my booking',
    'checkout.termsNotice': 'Secure payment by Stripe. By paying, you accept our terms of use.',
    'checkout.choosePaymentType': 'Choose payment type',
    'checkout.depositOnly': 'Deposit only',
    'checkout.fullPayment': 'Full payment',
    'checkout.commission': 'AfroPlan commission',
    'salon.photos': 'Salon photos',
    'salon.addPhotos': 'Add up to {max} photos of your salon',
    'salon.info': 'Salon information',
    'salon.name': 'Salon name',
    'salon.description': 'Description',
    'salon.phone': 'Phone',
    'salon.email': 'Email',
    'salon.emailHint': 'Email is from your account and cannot be changed',
    'salon.location': 'Location',
    'salon.address': 'Address',
    'salon.city': 'City',
    'salon.postalCode': 'Postal code',
    'salon.specialties': 'Afro hairstyling specialties',
    'salon.selectedSpecialties': 'selected',
    'salon.selectSpecialties': 'Select your specialties ({count} selected)',
    'salon.save': 'Save changes',
    'salon.saving': 'Saving...',
    'salon.saved': 'Salon saved!',
    'salon.savedDesc': 'Your salon information has been saved.',
    'salon.openingHours': 'Opening hours',
    'salon.homeService': 'Home service',
    'salon.homeServiceDesc': 'Do you offer home service?',
    'salon.homeServiceFee': 'Travel fee',
    'salon.homeServiceTravel': 'I travel to clients',
    'salon.connectLogin': 'Log in',
    'salon.createPro': 'Create Pro account',
    'salon.mySalon': 'My salon',
    'salon.loginMessage': 'Log in to create and manage your salon, add photos and specialties',
    'salon.limitReached': 'Limit reached',
    'salon.maxPhotosMessage': 'You can add up to {max} photos.',
    'salon.permissionRequired': 'Permission required',
    'salon.galleryPermission': 'You must allow gallery access to add photos.',
    'salon.cameraPermission': 'You must allow camera access to take photos.',
    'salon.deletePhoto': 'Delete photo',
    'salon.deletePhotoConfirm': 'Do you really want to delete this photo?',
    'salon.notFound': 'Salon not found',
    'salon.notFoundDesc': 'This salon does not exist or has been deleted.',
    'salon.about': 'About',
    'salon.services': 'Services',
    'salon.gallery': 'Gallery',
    'salon.noServices': 'No services available',
    'salon.selectServiceHint': 'Select a service',
    'salon.call': 'Call',
    'salon.directions': 'Directions',
    'salon.photoChoice': 'Add a photo',
    'salon.takePhoto': 'Take a photo',
    'salon.chooseFromGallery': 'Choose from gallery',
    'salon.namePlaceholder': 'E.g.: Afro Beauty Paris',
    'salon.descriptionPlaceholder': 'Describe your salon, specialties...',
    'salon.phonePlaceholder': 'E.g.: +33 6 12 34 56 78',
    'salon.addressPlaceholder': 'E.g.: 123 Main Street',
    'salon.cityPlaceholder': 'E.g.: Paris',
    'tab.home': 'Home',
    'tab.styles': 'Styles',
    'tab.search': 'Search',
    'tab.favorites': 'Favorites',
    'tab.profile': 'Profile',
    'day.monday': 'Monday',
    'day.tuesday': 'Tuesday',
    'day.wednesday': 'Wednesday',
    'day.thursday': 'Thursday',
    'day.friday': 'Friday',
    'day.saturday': 'Saturday',
    'day.sunday': 'Sunday',
  },

  de: {
    'common.loading': 'Laden...',
    'common.error': 'Fehler',
    'common.success': 'Erfolg',
    'common.cancel': 'Abbrechen',
    'common.confirm': 'Best√§tigen',
    'common.save': 'Speichern',
    'common.delete': 'L√∂schen',
    'common.edit': 'Bearbeiten',
    'common.close': 'Schlie√üen',
    'common.next': 'Weiter',
    'common.back': 'Zur√ºck',
    'common.search': 'Suchen',
    'common.seeAll': 'Alle anzeigen',
    'common.seeLess': 'Weniger anzeigen',
    'common.seeResults': 'Ergebnisse anzeigen',
    'common.add': 'Hinzuf√ºgen',
    'common.errorOccurred': 'Ein Fehler ist aufgetreten. Bitte versuche es erneut.',
    'common.available': 'Verf√ºgbar',
    'common.open': 'Ge√∂ffnet',
    'common.closed': 'Geschlossen',
    'common.verified': 'Verifiziert',
    'common.copyright': '¬© 2025 AfroPlan. Alle Rechte vorbehalten.',
    'auth.login': 'Anmelden',
    'auth.register': 'Registrieren',
    'auth.logout': 'Abmelden',
    'auth.email': 'E-Mail',
    'auth.password': 'Passwort',
    'auth.forgotPassword': 'Passwort vergessen?',
    'auth.noAccount': 'Kein Konto?',
    'auth.hasAccount': 'Bereits ein Konto?',
    'auth.loginRequired': 'Anmeldung erforderlich',
    'home.welcome': 'Willkommen bei AfroPlan',
    'home.hello': 'Hallo {name}',
    'home.readyForHairstyle': 'Bereit f√ºr eine neue Frisur?',
    'home.searchSalon': 'Meinen Salon / Friseur suchen',
    'home.searchSubtitle': 'Finde den Stil, der zu dir passt',
    'home.promotions': 'Aktuelle Angebote',
    'home.hairstyles': 'Frisuren',
    'home.nearbyCoiffeurs': 'Friseure in der N√§he',
    'home.popularSalons': 'Beliebte Salons',
    'home.tipsAndInspiration': 'Tipps & Inspiration',
    'home.areYouCoiffeur': 'Bist du Friseur(in)?',
    'home.joinAfroPlanPro': 'Tritt AfroPlan Pro bei und entwickle dein Gesch√§ft',
    'home.discoverPro': 'AfroPlan Pro entdecken',
    'hairstyle.tresses': 'Z√∂pfe',
    'hairstyle.locks': 'Locks',
    'hairstyle.coupe': 'Schnitt',
    'hairstyle.soins': 'Pflege',
    'hairstyle.coloration': 'F√§rbung',
    'hairstyle.tissage': 'Weave',
    'hairstyle.cornrows': 'Cornrows',
    'hairstyle.afro': 'Afro',
    'salon.openingHours': '√ñffnungszeiten',
    'salon.homeService': 'Hausbesuch',
    'salon.homeServiceDesc': 'Bieten Sie Hausbesuche an?',
    'salon.homeServiceTravel': 'Ich fahre zu Kunden',
    'tab.home': 'Startseite',
    'tab.styles': 'Stile',
    'tab.search': 'Suche',
    'tab.favorites': 'Favoriten',
    'tab.profile': 'Profil',
    'day.monday': 'Montag',
    'day.tuesday': 'Dienstag',
    'day.wednesday': 'Mittwoch',
    'day.thursday': 'Donnerstag',
    'day.friday': 'Freitag',
    'day.saturday': 'Samstag',
    'day.sunday': 'Sonntag',
  },

  es: {
    'common.loading': 'Cargando...',
    'common.error': 'Error',
    'common.success': '√âxito',
    'common.cancel': 'Cancelar',
    'common.confirm': 'Confirmar',
    'common.save': 'Guardar',
    'common.delete': 'Eliminar',
    'common.edit': 'Editar',
    'common.close': 'Cerrar',
    'common.next': 'Siguiente',
    'common.back': 'Atr√°s',
    'common.search': 'Buscar',
    'common.seeAll': 'Ver todo',
    'common.seeLess': 'Ver menos',
    'common.seeResults': 'Ver resultados',
    'common.add': 'A√±adir',
    'common.errorOccurred': 'Ha ocurrido un error. Int√©ntelo de nuevo.',
    'common.available': 'Disponible',
    'common.open': 'Abierto',
    'common.closed': 'Cerrado',
    'common.verified': 'Verificado',
    'common.copyright': '¬© 2025 AfroPlan. Todos los derechos reservados.',
    'auth.login': 'Iniciar sesi√≥n',
    'auth.register': 'Registrarse',
    'auth.logout': 'Cerrar sesi√≥n',
    'auth.email': 'Correo electr√≥nico',
    'auth.password': 'Contrase√±a',
    'auth.forgotPassword': '¬øOlvidaste tu contrase√±a?',
    'auth.noAccount': '¬øNo tienes cuenta?',
    'auth.hasAccount': '¬øYa tienes cuenta?',
    'auth.loginRequired': 'Inicio de sesi√≥n requerido',
    'home.welcome': 'Bienvenido a AfroPlan',
    'home.hello': 'Hola {name}',
    'home.readyForHairstyle': '¬øListo para un nuevo peinado?',
    'home.searchSalon': 'Buscar mi sal√≥n / estilista',
    'home.searchSubtitle': 'Encuentra el estilo que te queda',
    'home.promotions': 'Ofertas actuales',
    'home.hairstyles': 'Estilos de peinado',
    'home.nearbyCoiffeurs': 'Estilistas cercanos',
    'home.popularSalons': 'Salones populares',
    'home.tipsAndInspiration': 'Consejos e Inspiraci√≥n',
    'home.areYouCoiffeur': '¬øEres estilista?',
    'home.joinAfroPlanPro': '√önete a AfroPlan Pro y haz crecer tu negocio',
    'home.discoverPro': 'Descubrir AfroPlan Pro',
    'hairstyle.tresses': 'Trenzas',
    'hairstyle.locks': 'Locks',
    'hairstyle.coupe': 'Corte',
    'hairstyle.soins': 'Tratamientos',
    'hairstyle.coloration': 'Coloraci√≥n',
    'hairstyle.tissage': 'Tejido',
    'hairstyle.cornrows': 'Cornrows',
    'hairstyle.afro': 'Afro',
    'salon.openingHours': 'Horario de apertura',
    'salon.homeService': 'Servicio a domicilio',
    'salon.homeServiceDesc': '¬øOfreces servicio a domicilio?',
    'salon.homeServiceTravel': 'Me desplazo a los clientes',
    'tab.home': 'Inicio',
    'tab.styles': 'Estilos',
    'tab.search': 'B√∫squeda',
    'tab.favorites': 'Favoritos',
    'tab.profile': 'Perfil',
    'day.monday': 'Lunes',
    'day.tuesday': 'Martes',
    'day.wednesday': 'Mi√©rcoles',
    'day.thursday': 'Jueves',
    'day.friday': 'Viernes',
    'day.saturday': 'S√°bado',
    'day.sunday': 'Domingo',
  },
};

const LANGUAGE_STORAGE_KEY = '@afroplan_language';

const LanguageContext = createContext<LanguageContextType | undefined>(undefined);

export function LanguageProvider({ children }: { children: React.ReactNode }) {
  const [language, setLanguageState] = useState<Language>('fr');
  const [isReady, setIsReady] = useState(false);

  // Load saved language on mount, or detect device locale
  useEffect(() => {
    loadSavedLanguage();
  }, []);

  const loadSavedLanguage = async () => {
    try {
      const savedLanguage = await AsyncStorage.getItem(LANGUAGE_STORAGE_KEY);
      if (savedLanguage && ['fr', 'en', 'de', 'es'].includes(savedLanguage)) {
        setLanguageState(savedLanguage as Language);
      } else {
        // Premier lancement : d√©tecter la langue du t√©l√©phone
        const deviceLang = getDeviceLocale();
        setLanguageState(deviceLang);
        await AsyncStorage.setItem(LANGUAGE_STORAGE_KEY, deviceLang);
      }
    } catch {
      // Fallback silencieux
    } finally {
      setIsReady(true);
    }
  };

  const setLanguage = async (lang: Language) => {
    try {
      await AsyncStorage.setItem(LANGUAGE_STORAGE_KEY, lang);
      setLanguageState(lang);
    } catch {
      // Fallback silencieux
    }
  };

  // Translation function with parameter interpolation
  const t = useCallback((key: string, params?: Record<string, string | number>): string => {
    let text = translations[language][key] || translations['fr'][key] || key;
    if (params) {
      Object.entries(params).forEach(([k, v]) => {
        text = text.replace(new RegExp(`\\{${k}\\}`, 'g'), String(v));
      });
    }
    return text;
  }, [language]);

  return (
    <LanguageContext.Provider
      value={{
        language,
        setLanguage,
        t,
        languages: LANGUAGES,
        isReady,
      }}
    >
      {children}
    </LanguageContext.Provider>
  );
}

export function useLanguage() {
  const context = useContext(LanguageContext);
  if (!context) {
    throw new Error('useLanguage must be used within a LanguageProvider');
  }
  return context;
}
